@(songs: IndexedSeq[Song])

@main("DJ - Songs library") {
    <div class="span4">
        <h2>Now playing</h2><br/>
        <script type="text/html" id="playing_tmpl">
            <strong><%= name %></strong><br/>
            from: <%= album %><br/>
            by: <%= artist %>
        </script>
        <address id="playing">
            <strong>Nothing</strong><br/>
            from: <br/>
            by: 
        </address>
        <script type="text/html" id="pict_tmpl">
            <img src="<%= img %>">
        </script>
        <div id="pict">
            <img src="@services.LastFM.emptyCover">
        </div>
        <br/>
        <a href="#" id="play" class="btn btn-success"><i class="icon-play icon-white"></i></a>
        <a href="#" id="next" class="btn btn-success"><i class="icon-fast-forward icon-white"></i></a>
        <a href="#" id="stop" class="btn btn-danger"><i class="icon-stop icon-white"></i></a>
        <a href="#" id="clear" class="btn btn-primary"><i class="icon-remove icon-white"></i></a>
        <br/><br/>
        <h2>Song Queue</h2><br/>
        <script type="text/html" id="queue_tmpl">
            <tr>
                <td><%= name %></td>
                <td style="width: 70px">
                    <a href="<%= id %>" class="copy-queue btn btn-mini btn-success">
                        <i class="icon-play icon-white"></i>
                    </a>
                    &nbsp;
                    <a href="<%= id %>" class="delete-queue btn btn-mini btn-danger">
                        <i class="icon-remove icon-white"></i>
                    </a>
                </td>
            </tr>
        </script>
        <table id="queue" class="table table-striped table-condensed table-bordered"></table>
    </div>
    <div class="span8">
    @if(songs.isEmpty) {
        <div class="alert">
            Ooops, library is empty
        </div>
    } else {
        <form class="well form-search">
            Search a particular song / album / artist <input type="text" class="input-medium search-query" id="id_search" style="float: right">
        </form>
        <table id="library" class="table table-striped table-condensed table-bordered tablesorter">
        <thead>
            <tr>
                <th></th>
                <th>
                    <b>Name</b>
                </th>
                <th>
                    <b>Album</b>
                </th>
                <th>
                    <b>Artist</b>
                </th>
            </tr>
        </thead>
        <tbody>
            <tr id="noresults" style="display: none; ">
                <td>No Results</td>
            </tr>
        @for(song <- songs) {
            <tr>
                <td style="width: 50px">
                    <a href="@song.id" class="play-queue btn btn-inverse" title="Add to play queue"><i class="icon-plus-sign icon-white "></i></a>
                </td>
                <td style="width: 400px">
                    @song.name
                </td>
                <td style="width: 150px">
                    @song.album
                </td>
                <td style="width: 150px">
                    @song.artist
                </td>
            </tr>
        }
        </tbody>
        </table>
    }
    </div>

    <script type="text/javascript">

        $('a.play-queue').live('click', function(e) {
            e.preventDefault()
            var href = $(this).attr('href')
            $.post('@routes.Application.enqueue()', {id: href})
        })
        $('a.copy-queue').live('click', function(e) {
            e.preventDefault()
            var href = $(this).attr('href')
            $.post('@routes.Application.stopSong()')
            $.post('@routes.Application.prequeue()', {id: href}, function(data) {
                $.post('@routes.Application.playSong()')
            })
        })
        $('a.delete-queue').live('click', function(e) {
            e.preventDefault()
            var href = $(this).attr('href')
            $.post('@routes.Application.deletequeue()', {id: href})
        })
        $('#play').click(function(e) {
            e.preventDefault()
            $.post('@routes.Application.playSong()')
        });
        $('#next').click(function(e) {
            e.preventDefault()
            $.post('@routes.Application.stopSong()', function(data) {
                $.post('@routes.Application.playSong()')
            })
        });
        $('#stop').click(function(e) {
            e.preventDefault()
            $.post('@routes.Application.stopSong()')
        });
        $('#clear').click(function(e) {
            e.preventDefault()
            $.post('@routes.Application.clearQueue()')
        });
        var refresh = function() {
            $.get('@routes.Application.playing()', function(data) {
                $('#playing').html( tmpl('playing_tmpl', 
                    { 
                        name: data["name"], 
                        album: data["album"], 
                        artist: data["artist"] 
                    } 
                ))
                var pict = tmpl('pict_tmpl', { img: data["img"] } )
                if ($('#pict').html() != pict) {
                    $('#pict').html( pict )
                }
                $('#queue').html("")
                var songs = data["queue"]
                for (i in songs) {
                    $('#queue').append( tmpl('queue_tmpl', 
                        { 
                            id: songs[i]["id"], 
                            name: songs[i]["name"] 
                        } 
                    ))
                }
            })
        }
        $(document).ready(function () {             
            $("#id_search").quicksearch("#library tbody tr", {                 
                noResults: '#noresults',                    
                stripeRows: ['odd', 'even']                    
            });  
            $("#library").tablesorter(); 
            refresh()
            setInterval(refresh, 1000);
        });
    </script>
}